<!DOCTYPE html>
<html>
<head>
	<title>2048</title>
	<script>
	/*
	 *	      Slide Blok Puzzle
	 *         	Howard Xu
	 *        Dec. 14, 2014
	 */
    </script>
    <style>
    #outside {
        background-color: #a0a0a0;
        width: 500px;
        height: 500px;
    }
    .num_0 {
        background-color: #f8f8f8;
    }
    .num_2 {
        background-color: #ffebc2;
    }
    .num_4 {
        background-color: #ffcc66;
    }
    .num_8 {
        background-color: #ffbb00;
    }
    .num_16 {
        background-color: #ff9966;
    }
    .num_32 {
        background-color: #ff6600;
    }
    .num_64 {
        background-color: #aaff66;
    }
    .num_128 {
        background-color: #55aaff;
    }
    .num_256 {
        background-color: #557799;
    }
    .num_512 {
        background-color: #afafff;
    }
    .num_1024 {
        background-color: #5f5fff;
    }
    .num_2048 {
        background-color: #5f5f99;
    }
    th {
        border:4px solid #c0c0c0;
        background-color: #a0a0a0;
        color: #f0f0f0;
        width: 110px;
    }
    .cmd {
        cursor: pointer; 
    }
    td {
        border:12px solid #c0c0c0;
        width: 25%;
        height: 25%;
    }
    span {
        font-size: 3.2em;
        color: #a0a0a0;
    }
    </style>
	<script>
       function cubes (id) {
            var bd = document.getElementById(id);
            var num = []
            var fnum 
            var tls = document.getElementsByTagName("TH")
            var score = 0
            var best = 0
            tls[2].addEventListener("click", restart, false);
            tls[3].addEventListener("click", help, false);
            addEventListener("keydown", kydn, false);
            function upview() {
                tls[0].innerHTML = "Score: " + score
                if (best < score) best = score
                tls[1].innerHTML = "Best: " + best
            }
            function help() {
                alert("    The goal is to get a single square to be 2048.   Get two of the same number next to each other to add them together. \n    Use the arrow keys to add squares together.  ")
            }
            function kydn(e) {
                e = e || event;
                switch(e.keyCode) {
                    case 37: dmerge(0);		// left
                    break;
                    case 38: dmerge(1);		// up
                    break;
                    case 39: dmerge(2);		// right
                    break;
                    case 40: dmerge(3);		// down
                    break;
                }
            }
            function init() {
                s = ""
                for (i=0; i<16; i++) {
                    num[i] = 0
                    if (i%4 == 0) {
                        if (i !=0) s += "</tr>"
                        s += "<tr>"
                    }
                    s += "<td id='T_" + i + "'></td>"
                }
                fnum = 0
                score = 0
                bd.innerHTML = s + "</tr>"
            }
            function merge(a, b, c, d) {
                n = 3
                while (num[a] == 0 && n > 0) {
                    num[a] = num[b]
                    num[b] = num[c]
                    num[c] = num[d]
                    num[d] = 0
                    n--
                }
                if (num[b] == 0) {
                    n = 2
                    while(num[b] == 0 && n > 0) {
                        score += num[b]
                        num[b] = num[c]
                        num[c] = num[d]
                        num[d] = 0
                        n--
                    }
                }
                else {
                    if (num[a] == num[b]) {
                        score += num[b]
                        num[a] += num[b]
                        num[b] = num[c]
                        num[c] = num[d]
                        num[d] = 0
                        fnum--
                    }
                }
                if (num[c] == 0) {
                    num[c] = num[d]
                    num[d] = 0
                }
                else {
                    if (num[b] == num[c]) {
                        score += num[b]
                        num[b] += num[c]
                        num[c] = num[d]
                        num[d] = 0
                        fnum--
                    }
                }
                if (num[d] != 0 && num[c] == num[d]) {
                    score += num[c]
                    num[c] += num[d]
                    num[d] = 0
                    fnum--
                }
            }
            function dmerge(n) {
               switch(n) {
                    case 0: // left
                        merge(0, 1, 2, 3)
                        merge(4, 5, 6, 7)
                        merge(8, 9, 10, 11)
                        merge(12, 13, 14, 15) 
                    break;
                    case 1: // up
                        merge(0, 4, 8, 12)
                        merge(1, 5, 9, 13)
                        merge(2, 6, 10, 14)
                        merge(3, 7, 11, 15)
                    break;
                    case 2: // right
                        merge(3, 2, 1, 0)
                        merge(7, 6, 5, 4)
                        merge(11, 10, 9, 8)
                        merge(15, 14, 13, 12)
                    break;
                    case 3: // down
                        merge(12, 8, 4, 0)
                        merge(13, 9, 5, 1)
                        merge(14, 10, 6, 2)
                        merge(15, 11, 7, 3)
                    break;
                }
                if (fnum == 16) {
                    alert("You lost game, do again")
                    init()
                    set(2)
                }
                rset()
                show()
            }
            function set(n) {
                k = Math.floor(Math.random() * 16)
                while(fnum < 16 && num[k] != 0) 
                    k = Math.floor(Math.random() * 16)
                num[k] = n
                fnum++
            }
            function show() {
                f = 0
                for (i=0; i<16; i++) {
                    s = ""
                    if(num[i] != 0) 
                        s = "<span >" + num[i] + "</span>"
                    tid = document.getElementById("T_"+i)
                    tid.innerHTML = s
                    tid.className = "num_" + num[i]
                    if (f < num[i]) f = num[i]
                }
                upview()
                if (f == 2048) {
                    alert("Congratulation! You win")
                }
            }
            function rset() {
                if (Math.random() > 0.5)
                    set(4)
                else
                    set(2);
            }
            function restart() {
                init()
                set(2);
                rset();
                show()
            }
            return {
                init: function() {
                    restart();
                }
            }
        }
        var cb;
     </script>
</head>
<body>
    <center>
    <table><tr>
        <th></th>
        <th></th>
        <th class="cmd">New Game</th>
        <th class="cmd">Help</th>
    </tr></table> <br>
    <table id="outside">
    </table>
<script> 
    cb=cubes("outside").init(); 
</script>
</body>
</html>